# Lab Environment

In this lab environment, you will have GUI access to a Kali machine with access to a captured network packet file **test.pcap**.

**Objective:** Use network analysis techniques to identify and capture the following flags related to the infection and attack:

- **Flag 1:** What is the domain name(abcd.site) accessed by the infected user that returned a 200 OK response code?
- **Flag 2:** What is the IP address, MAC address of the infected Windows client?
- **Flag 3:** Which Wireshark filter can you use to determine the victim’s hostname from NetBIOS Name Service traffic, and what is the detected hostname for this malware infection?
- **Flag 4:** Which user got infected and ran the mystery_file.ps1 PowerShell script?
- **Flag 5:** What User-Agent string indicates the traffic generated by a PowerShell script?
- **Flag 6:** Which wallet extension ID is associated with the Coinbase wallet?

# Tools

The best tools for this lab are:

- Wireshark

Wireshark is a free and widely used network analysis tool. It allows you to capture and inspect data packets in real-time. With Wireshark, we can troubleshoot network issues, analyze traffic, and even find security vulnerabilities.

Press enter or click to view image in full size

![9b6bf5c6bbd3d375170593bbd223a07a.png](resources/9b6bf5c6bbd3d375170593bbd223a07a.png)

**Flag 1: What is the URL accessed by the infected user that returned a 200 OK response code?**

To find this, open the `test.pcap` file.

![d8cbac8c2d0431608327624dae8f449b.png](resources/d8cbac8c2d0431608327624dae8f449b.png)

Now, the question asks us to identify the URL accessed by the user that returned a 200 OK response code. To do this, we can use the following Wireshark filter:

&nbsp;http.response.code==200

This filter will display all HTTP responses with a 200 OK status, making it easier to locate the required URL.

![8173f64e61100d0a64625da2864a88f3.png](resources/8173f64e61100d0a64625da2864a88f3.png)

In the Hypertext Transfer Protocol dropdown, you will find a parameter named `Request URI`.

![10dc63707c5de66de770acdf943607ac.png](resources/10dc63707c5de66de770acdf943607ac.png)

Copy the value of the **Request URI** and extract only the top domain, which is: 623start.site.

So our first flag is: 623start.site

**Flag 2: What is the IP address, MAC address of the infected Windows client?**

To identify the infected Windows client, focus on the traffic that went through HTTP. Use the following filter in Wireshark: `http`

This will display all HTTP traffic, helping you locate the necessary information.

![ef2adbcd0166d84504ed2eacd0805c4e.png](resources/ef2adbcd0166d84504ed2eacd0805c4e.png)

At the top, you can see a request mentioning **Windows Defender**. From this, identify the source IP address and copy it. The IP address is: 10.7.10.47

To find the MAC address, expand the **Ethernet II** section and note the source MAC address.

![ceabaa965ad2a985cd81832c907ab383.png](resources/ceabaa965ad2a985cd81832c907ab383.png)

From the **Ethernet II** section, we find the MAC address, which is: 80:86:5b:ab:1e:c4.

So our second flag: 10.7.10.47, 80:86:5b:ab:1e:c4

**Flag 3: Which Wireshark filter can you use to determine the victim’s hostname from NetBIOS Name Service traffic, and what is the detected hostname for this malware infection?**

To determine the victim’s hostname, the Wireshark filter used is: `nbns`

This filter will display NetBIOS Name Service traffic, identify the victim’s hostname.

![234e3d412111c1331113b0e231be3360.png](resources/234e3d412111c1331113b0e231be3360.png)

To find the hostname, expand **NETBIOS Name Service** and then click on **Queries**. This will display the relevant details for identifying the victim’s hostname.

Press enter or click to view the image in full size

![6ceb878b5eef17b28a196d1ace587132.png](resources/6ceb878b5eef17b28a196d1ace587132.png)

Third flag nbns, DESKTOP-9PEA63H

**Flag 4: Which user got infected and ran the mystery_file.ps1 PowerShell script?**

To open search click edit and click **Find Packet** ![035f71df38582a5df75ffbb5439514d3.png](resources/035f71df38582a5df75ffbb5439514d3.png)

or press **CTRL+F** to search.

<img alt="" class="bi jz nk c jop-noMdConv" width="700" height="88" loading="lazy" role="presentation" src="resources/1_8vJ8XqK3Ee6NNKLJGt8F6Q.png" style="box-sizing: inherit; vertical-align: middle; background-color: rgb(255, 255, 255); width: 680px; max-width: 100%; height: auto;">

Change the **Display Filter** to **String** and enter the file name you are looking for: `mystery_file.ps1`. Then, search using **Packet bytes** on the left side click on Find.

![be4850b8aaed60ea4473f8a4c6b18aa1.png](resources/be4850b8aaed60ea4473f8a4c6b18aa1.png)

Copy the content on the right side by right-clicking and selecting **as Printable Text**.

![e2531ec810bb260d72c41824e3f930d0.png](resources/e2531ec810bb260d72c41824e3f930d0.png)

Paste the content into a text editor, like Notepad, to enumerate. After enumerating, we find the user, who is: rwalters

![4bdcc11cc73c09f77f8c7ce7dc638e15.png](resources/4bdcc11cc73c09f77f8c7ce7dc638e15.png)

**Flag 5: What User-Agent string indicates the traffic generated by a PowerShell script?**

Open search. In the **String** parameter, type `PowerShell`, and search using **Packet Details** on the left side of the **Find** functionality.

Expand the **Hypertext Transfer Protocol** section and copy the `User-Agent` from there.

![e9f95ae5106ab3202f21dcb3d94c12eb.png](resources/e9f95ae5106ab3202f21dcb3d94c12eb.png)

Only the name of PowerShell: WindowsPowerShell

**Q.6: Which wallet extension ID is associated with the Coinbase wallet?**

Open to search. In the **String** parameter, type `Coinbase` and search using **Packet Bytes** on the left side

![80baf6ad6fa720ef15c47f445169bde1.png](resources/80baf6ad6fa720ef15c47f445169bde1.png)

Here, we found some details for Coinbase. Right-click the main request and select **Follow** > **TCP Stream**

![5c56540ae32132ded582062de9a0c408.png](resources/5c56540ae32132ded582062de9a0c408.png)

Search Coinbase

![3aae16a9c7e3a04178a5d5b814a088f0.png](resources/3aae16a9c7e3a04178a5d5b814a088f0.png)

Here, we found our last flag, which is:

![ec95414d444a4347bbcee33394978297.png](resources/ec95414d444a4347bbcee33394978297.png)

hnfanknocfeofbddgcijnmhnfnkdnaad
